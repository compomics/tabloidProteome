<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html"
 xmlns:p="http://primefaces.org/ui" >

<h:head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="" />
  <meta name="author" content="" />

  <title>Tabloid Proteome</title>

  <!-- Bootstrap Core CSS -->
  <link href="resources/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Custom CSS -->
  <link href="resources/css/bootstrap.css" rel="stylesheet" />

  <script src="http://code.jquery.com/jquery-2.1.4.min.js" type="text/javascript"></script>


  <link href="resources/css/custom.css" rel="stylesheet" />
  <link href="resources/css/sticky-footer.css" rel="stylesheet" />
  <link href="resources/css/bootstrap-table-expandable.css" rel="stylesheet" />

  <!-- Bootstrap Core JavaScript -->
  <script src="resources/js/bootstrap.min.js"></script>
  <script src="resources/js/bootstrap-table-expandable.js"></script>
  <style>
    body {
	 padding-top: 70px;
	 /* Required padding for .navbar-fixed-top. Remove if using .navbar-static-top. Change if height of navigation changes. */
    }   
  </style>
  <script src="http://cytoscape.github.io/cytoscape.js/api/cytoscape.js-latest/cytoscape.min.js"></script>
      <script>
      $(function(){
        var offsets = document.getElementById('cy').getBoundingClientRect();
        var height = offsets.height;
        var width = offsets.width;
        var nodes = document.getElementById('nodes').value.slice(1, document.getElementById('nodes').value.length-1).split(',');
      
        var edges = document.getElementById('edges').value.slice(1, document.getElementById('edges').value.length-1).split(',');
        
        var jaccSimScores = document.getElementById('jaccSimScores').value.slice(1, document.getElementById('jaccSimScores').value.length-1).split(',');
        
          var newObj = [];
          var count;
          if(nodes.length == 2){
            for(count = 0; count &lt; nodes.length; count++){
              newObj.push({ group: "nodes", data: { id: nodes[count] }, position: { x: width/4 +250*count , y: height/2 } });
            }
          }
        if(nodes.length &gt; 2){
          var angle = 2 * Math.PI /(nodes.length-1);
          newObj.push({ group: "nodes", data: { id: nodes[0] }, position: { x: width/2 , y: height/2} });
          for(count = 1; count &lt; nodes.length; count++){
            newObj.push({ group: "nodes", data: { id: nodes[count] }, position: { x: width/2 + 180 * Math.cos(angle * (count-1)) , y: height/2 + 180 * Math.sin(angle * (count-1)) } });
          }
        }
        for(count=0; count &lt; nodes.length - 1; count++){
          newObj.push({ group: "edges", data: { id: edges[count], source: nodes[0], target: nodes[count+1] , label: jaccSimScores[count]} });
        }

        var cy = cytoscape({
          container: document.getElementById('cy'),
          boxSelectionEnabled: false,
          autounselectify: true,
          style: cytoscape.stylesheet()
              .selector('node')
              .css({
                  'content': 'data(id)',
                  'text-valign': 'center',
                  'background-color': '#0099CC',
                  'width' : '80px',
                  'height' : '45px'
              })
              .selector('node:selected')
                .css({
                  'background-color': '#E4860D'
                })  
              .selector('edge')
              .css({
                  'width': 2,
                  'line-color': 'red',
                  'label': 'data(label)',
                  'color' : 'black',
                  'line-style' : 'solid',   
              })
              .selector('.highlighted')
              .css({
                'line-color': '#E4860D',
                  'transition-property': 'line-color',
                  'transition-duration': '0.5s'
               }),
          layout: {
              name: 'circle',
              directed: true,
              padding: 10
          },
          userZoomingEnabled: false,
        }); 
        cy.add(newObj);
 
        cy.on('tap', 'node', function (evt) {

            passNodeToJSFManagedBean ([ {
                  name : 'selectedNode',
                  value : evt.cyTarget.id()
                 }
               ]); 
            
            return false;
          });
        cy.on('tap', 'edge', function (evt) {
            passEdgeToJSFManagedBean ([ {
                  name : 'selectedEdge',
                  value : evt.cyTarget.id()
                  
                 }
               ]);
            $(window).scrollTop(200);
            return false;
            
          });
        $("#click-me").click(function(e) {
     		var pngData = cy.png();
     	    $('#click-me').attr('href', pngData);
     	});
      });
  
  
      window.onbeforeunload = function () {
    	  window.scrollTo(0, 0);
    	}
   
      
      function clickButton() {
          document.getElementById('btnproteinDetail').click();
          return false;
      }
      
      function displayPanel() {
          document.getElementById('divRelations').style.display = 'block';
          return false;
      }
 
     
 
      </script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-96922635-1', 'auto');
  ga('send', 'pageview');

</script>
</h:head>

<body>
    <div id="wrapper">
    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation" >
        <div class="container" id="header">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="/tabloidproteome/search.xhtml" class="navbar-left"><img src="resources/images/logo.png" style="width:70px; height: 54px;"/></a>
                <a class="navbar-brand" href="/tabloidproteome/search.xhtml">Tabloid Proteome</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav pull-right">
                    <li>
                        <a href="/tabloidproteome/search.xhtml">Search</a>
                    </li>
                    <li>
                        <a href="/tabloidproteome/dataTable.xhtml">Data Table</a>
                    </li>
                    <li>
                        <a href="/tabloidproteome/help.xhtml">Help</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>


    
    <!-- Page Content -->
    <div class="container" id="content">
        
      <h:form id="graphForm">
        <input type="hidden" id="nodes" value="#{visualisationBean.nodes}" />
        <input type="hidden" id="edges" value="#{visualisationBean.edges}" />
        <input type="hidden" id="jaccSimScores" value="#{visualisationBean.jaccSimScores}" />
        <h1></h1>
        <a download="graph.png" id="click-me"><i class="glyphicon glyphicon-cloud-download"></i> Download Graph</a>
        <div id="cy"></div>
        

        <div class="alert alert-info alert-dismissible" role="alert" style="width: 35%;">
          <div style="margin-bottom:15px;"><button type="button" class="close" data-dismiss="alert" aria-label="Close" ><span aria-hidden="true">&#215;</span></button></div>
          Click on the node/edge for more information.
        </div>
        <p:remoteCommand name="passNodeToJSFManagedBean" id="passNodeToJSFManagedBeancmd" action="#{visualisationBean.getNode}" process="@this"
          oncomplete="clickButton();" update="graphForm:proteinDetailPanel" />
        <input type="button" id="btnproteinDetail" data-toggle="modal" data-target="#proteinDetails" style="display: none;"></input>
        <h:panelGroup layout="block" id="proteinDetailPanel">
          <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"
            id="proteinDetails">
            <div class="modal-dialog modal-lg">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&#xd7;</button>
                  <h4 class="modal-title text-center">Protein Details</h4>
                </div>
                <div class="modal-body">
                <table class="table table-hover">
                  <tr>
                    <td width="20%">Uniprot Accession :</td>
                    <td><a target="_blank" href="http://www.uniprot.org/uniprot/#{visualisationBean.selectedProtein.uniprotAccession}">#{visualisationBean.selectedProtein.uniprotAccession}</a></td>
                  </tr>
                  <tr>
                    <td width="20%">Uniprot Status :</td>
                    <td>#{visualisationBean.selectedProtein.uniprotStatus}</td>
                  </tr>
                  <tr>
                    <td width="20%">Protein Name :</td>
                    <td>#{visualisationBean.selectedProtein.proteinName}</td>
                  </tr>
                  <tr>
                    <td width="20%">Protein Entry Name :</td>
                    <td>#{visualisationBean.selectedProtein.uniprotEntryName}</td>
                  </tr>
                  <tr>
                    <td width="20%">Gene Name :</td>
                    <td>#{visualisationBean.selectedProtein.geneName}</td>
                  </tr>
                  <tr>
                    <td width="20%">Species :</td>
                    <td>#{visualisationBean.selectedProtein.species}</td>
                  </tr>
                  <tr>
                    <td width="20%">Length :</td>
                    <td>#{visualisationBean.selectedProtein.getLenghth()}</td>
                  </tr>
                </table>
                </div>
              </div>
            </div>
          </div>
        </h:panelGroup>

        <p:remoteCommand name="passEdgeToJSFManagedBean" id="passEdgeToJSFManagedBeancmd" action="#{visualisationBean.getEdge}" process="@this" 
            oncomplete="displayPanel();" update="graphForm:relationsPanel" />
          <h:panelGroup layout="block" id="relationsPanel">
          
          <script>
          jQuery(function($) {
              $('.panel-heading span.clickable').on("click", function(e) {
                if ($(this).hasClass('panel-collapsed')) {
                  // expand the panel
                  $(this).parents('.panel').find('.panel-body').slideDown();
                  $(this).removeClass('panel-collapsed');
                  $(this).find('i').removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');
                } else {
                  // collapse the panel
                  $(this).parents('.panel').find('.panel-body').slideUp();
                  $(this).addClass('panel-collapsed');
                  $(this).find('i').removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');
                }
              });
            });
          </script>
          
          <div class="relations" style="display: none" id="divRelations">
            <h1></h1>
            <h4 style="text-align: center;">Association between #{visualisationBean.protein1.uniprotAccession} and #{visualisationBean.protein2.uniprotAccession}</h4>
            <div class="panel panel-default" style="border:none;">
                <div class="row" style="margin-top: 3px;">
                  <div class="col-sm-2">
                    <label>Jacc Similarity Score : </label> #{visualisationBean.association[0].jaccSimScore}
                  </div>
                  <div class="col-sm-2">
                    <label>Interaction : </label> #{visualisationBean.association[0].interact}
                  </div>
                  <div class="col-sm-2">
                    <label>Ensembl Paralog : </label> #{visualisationBean.association[0].paralog}
                  </div>
              </div>
            </div>
            
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title">Interactions</h3>
                <span class="pull-right clickable panel-collapsed"><i class="glyphicon glyphicon-chevron-down"></i></span>
              </div>
              <div class="panel-body panel-collapse collapse ">
                <div class="row" style="margin-top: 3px;">
                  <div class="col-sm-2">
                    <label>IntAct : </label> #{visualisationBean.association[0].intact}
                  </div>
                  <div class="col-sm-2">
                    <label>BioGRID : </label> #{visualisationBean.association[0].bioGrid}
                  </div>
                </div>
                <div class="wrap">
                  <table class="head ">
                    <tr>
                      <th style="width: 12%;">Intact Confidence</th>
                      <th style="width: 19%;">Intact Detection</th>
                      <th style="width: 19%;">Intact Interaction Type</th>
                    </tr>
                  </table>
                  <div class="inner_table">
                    <table>
                      <ui:repeat var="associate" value="#{visualisationBean.association}">
                        <tr>
                          <td style="width: 12%;">#{associate.intactConfidence}</td>
                          <td style="width: 26%;">#{associate.intactDetection}</td>
                          <td style="width: 26%;">#{associate.intactInteractionType}</td>
                        </tr>
                      </ui:repeat>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <div class="panel panel-default ">
                  <div class="panel-heading">
                    <h3 class="panel-title">Common Projects</h3>
                    <span class="pull-right clickable panel-collapsed"><i class="glyphicon glyphicon-chevron-down"></i></span>
                  </div>
                  <div class="panel-body panel-collapse collapse" >
                    <div class="wrap">
                      <table class="head ">
                        <tr>
                          <th style="width: 5%;">No</th>
                          <th style="width: 20%;">Project Accession</th>
                          <th style="width: 20%;">Keywords</th>
                          <th style="width: 35%;">Tissue</th>
                          <th style="width: 20%;">Tags</th>
                        </tr>
                      </table>
                      <div class="inner_table">
                        <table>
                          <ui:repeat var="project" value="#{visualisationBean.projects}" varStatus="status">
                          <tr>
                            <td style="width: 5%;">#{status.index+1}</td>
                            <td style="width: 20%;"><a target="_blank" href="https://www.ebi.ac.uk/pride/archive/projects/#{project.projectAccession}">#{project.projectAccession}</a></td>
                            <td style="width: 20%;">#{project.keywords}</td>
                            <td style="width: 35%;">#{project.tissue}</td>
                            <td style="width: 20%;">#{project.tags}</td>
                          </tr>
                        </ui:repeat>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="panel panel-default ">
                  <div class="panel-heading">
                    <h3 class="panel-title">Pathways</h3>
                    <span class="pull-right clickable panel-collapsed"><i class="glyphicon glyphicon-chevron-down"></i></span>
                  </div>
                  <div class="panel-body panel-collapse collapse" >
                    <div class="wrap">
                      <table class="head ">
                        <tr>
                          <th style="width: 5%;">No</th>
                          <th style="width: 25%;">Reactome Accession</th>
                          <th style="width: 50%;">Pathway Name</th>
                          <th style="width: 20%;">Evidence Code</th>
                        </tr>
                      </table>
                      <div class="inner_table">
                        <table>
                          <ui:repeat var="pathWay" value="#{visualisationBean.pathWays}" varStatus="status">
                          <tr>
                            <td style="width: 5%;">#{status.index+1}</td>
                            <td style="width: 25%;"><a target="_blank" href="http://www.reactome.org/PathwayBrowser/#/#{pathWay.reactomeAccession}">#{pathWay.reactomeAccession}</a></td>
                            <td style="width: 50%;">#{pathWay.pathwayName}</td>
                            <td style="width: 20%;">#{pathWay.evidenceCode}</td>
                          </tr>
                        </ui:repeat>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="panel panel-default ">
                  <div class="panel-heading">
                    <h3 class="panel-title">Complexes</h3>
                    <span class="pull-right clickable panel-collapsed"><i class="glyphicon glyphicon-chevron-down"></i></span>
                  </div>
                  <div class="panel-body panel-collapse collapse" >
                    <div class="wrap">
                      <table class="head ">
                        <tr>
                          <th style="width: 3%;">No</th>
                          <th style="width: 6%;">Corum Id</th>
                          <th style="width: 14%;">Complex Name</th>
                          <th style="width: 20%;">Complex Comment</th>
                          <th style="width: 7%;">Cell Line</th>
                          <th style="width: 14%;">Disease Comment</th>
                          <th style="width: 11%;">Subunit Comment</th>
                          <th style="width: 7%;">Pubmed Id</th>
                          <th style="width: 18%;">Purification Method</th>
                        </tr>
                      </table>
                      <div class="inner_table">
                        <table>
                          <ui:repeat var="complex" value="#{visualisationBean.complexs}" varStatus="status">
                            <tr>
                              <td style="width: 3%;">#{status.index+1}</td>
                              <td style="width: 6%;"><a target="_blank" href="http://mips.helmholtz-muenchen.de/corum/">#{complex.corumId}</a></td>
                              <td style="width: 14%;">#{complex.complexName}</td>
                              <td style="width: 20%;">#{complex.complexComment}</td>
                              <td style="width: 7%;">#{complex.cellLine}</td>
                              <td style="width: 14%;">#{complex.diseaseComment}</td>
                              <td style="width: 11%;">#{complex.subUnitComment}</td>
                              <td style="width: 7%;"><a target="_blank"
                                href="https://www.ncbi.nlm.nih.gov/pubmed?cmd=search&amp;term=#{complex.pubmedId}">#{complex.pubmedId}</a></td>
                              <td style="width: 18%;">#{complex.purificationMethod}</td>
                            </tr>
                          </ui:repeat>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="panel panel-default ">
                  <div class="panel-heading">
                    <h3 class="panel-title">GO</h3>
                    <span class="pull-right clickable panel-collapsed"><i class="glyphicon glyphicon-chevron-down"></i></span>
                  </div>
                  <div class="panel-body panel-collapse collapse" >
                    <div class="wrap">
                      <h4>Molecular Function</h4>
                      <table class="head ">
                        <tr>
                          <th style="width: 5%;">No</th>
                          <th style="width: 45%;">MF Id</th>
                          <th style="width: 50%;">MF Name</th>
                        </tr>
                      </table>
                      <div class="inner_table">
                        <table>
                          <ui:repeat var="mf" value="#{visualisationBean.mf}" varStatus="status">
                          <tr>
                            <td style="width: 5%;">#{status.index+1}</td>
                            <td style="width: 45%;"><a target="_blank" href="http://www.ebi.ac.uk/QuickGO/GTerm?id=#{mf.id}">#{mf.id}</a></td>
                            <td style="width: 50%;">#{mf.name}</td>
                          </tr>
                        </ui:repeat>
                        </table>
                        </div>
                      </div>
                      <div class="wrap">
                      <h4>Biological Process</h4>
                        <table class="head ">
                          <tr>
                            <th style="width: 5%;">No</th>
                            <th style="width: 45%;">BP Id</th>
                            <th style="width: 50%;">BP Name</th>
                          </tr>
                        </table>
                        <div class="inner_table">
                          <table>
                            <ui:repeat var="bp" value="#{visualisationBean.bp}" varStatus="status">
                              <tr>
                                <td style="width: 5%;">#{status.index+1}</td>
                                <td style="width: 45%;"><a target="_blank" href="http://www.ebi.ac.uk/QuickGO/GTerm?id=#{bp.id}">#{bp.id}</a></td>
                                <td style="width: 50%;">#{bp.name}</td>
                              </tr>
                            </ui:repeat>
                          </table>
                        </div>
                      </div> 
                      <div class="wrap">
                      <h4>Cellular Component</h4>
                        <table class="head ">
                          <tr>
                            <th style="width: 5%;">No</th>
                            <th style="width: 45%;">CC Id</th>
                            <th style="width: 50%;">CC Name</th>
                          </tr>
                        </table>
                        <div class="inner_table">
                          <table>
                            <ui:repeat var="cc" value="#{visualisationBean.cc}" varStatus="status">
                              <tr>
                                <td style="width: 5%;">#{status.index+1}</td>
                                <td style="width: 45%;"><a target="_blank" href="http://www.ebi.ac.uk/QuickGO/GTerm?id=#{cc.id}">#{cc.id}</a></td>
                                <td style="width: 50%;">#{cc.name}</td>
                              </tr>
                            </ui:repeat>
                          </table>
                        </div>
                      </div>                  
                  </div>
                </div>
          </div>
          </h:panelGroup>
      </h:form>
      
    </div>
    <!-- /.container -->

    <div id="footer">
      <div class="container">
        <div class="row">
          <div class="col-sm-6">
            <p class="text-muted credit">SUPPORTED BY</p>
            <p class="text-muted credit"><a href="https://compomics.com" > <img border="0"
            src="resources/images/compOmics_logo.png" width="93px" height="48px" /></a>&#160;&#160;&#160;&#160;&#160;&#160;
            <a href="http://www.crl-mappit.be/" style="padding-left: 15px"> <img border="0"
            src="resources/images/cytokineLogo.png" width="106px" height="40px" /></a></p>
            <p class="text-muted credit"><a href="http://mbc.vib-ugent.be"> <img border="0"
            src="resources/images/MBCLogo.png" width="147px" height="53px"/></a>
            <a href="http://www.vib.be" style="padding-left: 15px;"> <img border="0" 
            src="resources/images/VIBLogo.png" width="88px" height="53px"/></a></p>
            <p class="text-muted credit"><a href="http://www.ugent.be/en"> <img border="0" 
            src="resources/images/ugent-logo.png" width="90px" height="70px" /></a></p>
          </div>
          <div class="col-sm-2">
            <p class="credit" style="margin-bottom: 15px;"><a href="/tabloidproteome/information.xhtml" class="text-muted">Information</a></p>
            <p class="credit" style="margin-bottom: 15px;"><a href="/tabloidproteome/information.xhtml#about" class="text-sub">About</a></p>
            <p class="credit" style="margin-bottom: 15px;"><a href="/tabloidproteome/information.xhtml#version" class="text-sub">Version</a></p>
            <p class="credit"><a href="/tabloidproteome/information.xhtml#licence" class="text-sub">Licence</a></p>
          </div>
          <div class="col-sm-2">
            <p class="credit" style="margin-bottom: 15px;"><a href="/tabloidproteome/data.xhtml" class="text-muted">Data</a></p>
            <p class="credit" style="margin-bottom: 15px;"><a href="/tabloidproteome/data.xhtml#statistics" class="text-sub">Statistics</a></p>
            <p class="credit" style="margin-bottom: 15px;"><a href="/tabloidproteome/data.xhtml#dataSource" class="text-sub">Data Source</a></p>
          </div>
          <div class="col-sm-2">
            <p class="credit" style="margin-bottom: 15px;"><a href="/tabloidproteome/help.xhtml" class="text-muted">Help</a></p>
            <p class="credit" style="margin-bottom: 15px;"><a href="/tabloidproteome/help.xhtml#documentation" class="text-sub">Documentation</a></p>
            <p class="credit"><a href="/tabloidproteome/help.xhtml#contact" class="text-sub">Contact</a></p>
          </div>
        </div>
      </div>
    </div>


 </div>
</body>

</html>
